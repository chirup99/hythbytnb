                                            width: `${Math.min(
                                              tag.winRate,
                                              100,
                                            )}%`,
                                          }}
                                        ></div>
                                      </div>
                                      <div className="flex items-center justify-between mb-1">
                                        <span className="text-[10px] uppercase tracking-wider text-slate-400 font-semibold">Success Rate</span>
                                        <span className="text-xs font-bold text-slate-600 dark:text-slate-400">
                                          {tag.winRate.toFixed(1)}%
                                        </span>
                                      </div>
                                      <div className="flex items-center justify-between border-t border-slate-50 dark:border-slate-700/50 pt-2 mt-2">
                                        <div className="flex flex-col">
                                          <span className="text-[9px] uppercase tracking-tighter text-slate-400 font-bold">Avg Duration</span>
                                          <span className="text-[10px] font-semibold text-slate-500">
                                            {(() => {
                                              const tagTrades = Object.values(filteredHeatmapData).filter((day: any) => {
                                                const dayData = day?.tradingData || day;
                                                return dayData.tradingTags?.some((t: string) => 
                                                  t.toLowerCase().trim() === tag.tag.toLowerCase().trim()
                                                );
                                              });

                                              if (tagTrades.length === 0) return "--";

                                              // Calculation follows these steps:
                                              // 1. Tag Filtering: It looks through all your trading days and finds only those that have the specific tag.
                                              // 2. Duration Extraction: For those specific days, it tries to read the avgDuration value from performance metrics.
                                              // 3. Parsing: It converts time strings (like "1h 20m") into total seconds.
                                              // 4. Averaging: It sums up the total seconds across all valid days and divides by the number of days.
                                              // 5. Formatting: Finally, it converts the average seconds back into a readable format like "5m 30s".
                                              const totalSeconds = validDurations.reduce((acc, dur) => acc + parseDuration(dur), 0);
                                              const avgSeconds = Math.round(totalSeconds / validDurations.length);
                                              
                                              const mins = Math.floor(avgSeconds / 60);
                                              const secs = avgSeconds % 60;
                                              return mins > 0 ? `${mins}m ${secs}s` : `${secs}s`;
                                            })()}
                                          </span>
                                        </div>
                                        <div className="text-right">
                                          <span className={`text-[10px] px-2 py-0.5 rounded-full font-bold uppercase tracking-tighter ${
                                            tag.tradingStyle === 'Scalper' ? 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' :
                                            tag.tradingStyle === 'Intraday' ? 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400' :
                                            tag.tradingStyle === 'Emotional Panic Exit' ? 'bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400' :
                                            'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-400'
                                          }`}>
                                            {tag.tradingStyle}
                                          </span>
                                        </div>
                                      </div>
                                    </div>
                                  ))}
                              </div>
                            ) : (
                              <div className="flex items-center justify-center h-32 text-slate-500 dark:text-slate-400">
                                <div className="text-center">
                                  <Tag className="w-8 h-8 mx-auto mb-2 opacity-50" />
                                  <p className="text-sm">No tag data</p>
                                </div>
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Strategy Summary Cards */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                          {(() => {
                            // Filter to only include dates with actual trading activity (non-zero P&L)
